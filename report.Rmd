---
title: "Untitled"
author: "Hiba Majdoubi"
date: "2025-02-20"
output: pdf_document
---


```{r}
install.packages("installr")
installr::install.java()
Sys.setenv(JAVA_HOME = "C:/Program Files/Java/jdk-21")
usethis::edit_r_environ()
JAVA_HOME="C:/Program Files/Java/jdk-21"

system("java -version")


library(h2o)
```


```{r}
h2o.shutdown(prompt = FALSE)  # ArrÃªter l'ancienne session si elle est active
h2o.init()  # RÃ©initialiser la session

df <- srcsc_2025_dam_data_for_students
df$`Assessment Date` <- as.Date(df$`Assessment Date`, format="%d/%m/%Y")  # ou "%Y-%m-%d"
df$`Last Inspection Date` <- as.Date(df$`Last Inspection Date`, format="%d/%m/%Y")  # ou "%Y-%m-%d"
str(df)

# Convertir les variables catÃ©goriques en facteur
for (col in names(df)) {
  if (is.character(df[[col]])) {
    df[[col]] <- as.factor(df[[col]])
  }
}

# ðŸ”¹ DÃ©tection automatique et imputation des dates
date_cols <- names(df)[sapply(df, function(x) inherits(x, "Date") | inherits(x, "POSIXct"))]

for (col in date_cols) {
  df[[col]] <- na.locf(df[[col]], na.rm = FALSE)  # Forward fill
  df[[col]] <- na.locf(df[[col]], fromLast = TRUE, na.rm = FALSE)  # Backward fill
}

h2o.init()
df_h2o <- as.h2o(df) 
  
  # ðŸ”¹ Appliquer l'imputation seulement sur les colonnes numÃ©riques
  num_cols <- names(df)[sapply(df, is.numeric)]  # SÃ©lectionner les colonnes numÃ©riques
  if(length(num_cols) > 0) {
    df_h2o[, num_cols] <- h2o.impute(df_h2o[, num_cols], method = "median")  # Appliquer l'imputation
  }
  
  
  df_imputed <- as.data.frame(df_h2o)  
  for (col in names(df_imputed)) {
    if (is.factor(df_imputed[[col]])) {
      mode_val <- names(sort(table(df_imputed[[col]]), decreasing = TRUE))[1]
      df_imputed[[col]][is.na(df_imputed[[col]])] <- mode_val  # Imputation avec le mode des catÃ©gories
    }
  }
  
  # Gestion des dates manquantes : forward et backward fill
  date_cols <- names(df_imputed)[sapply(df_imputed, function(x) inherits(x, "Date"))]
  for (col in date_cols) {
    df_imputed[[col]] <- na.locf(df_imputed[[col]], na.rm = FALSE)  # Forward fill
    df_imputed[[col]] <- na.locf(df_imputed[[col]], fromLast = TRUE, na.rm = FALSE)  # Backward fill
  }
  




```

